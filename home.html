<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aidan Lewertoff</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="is-home">

    <a href="#" class="back-link" onclick="toggleProject(null, event)">← Retour</a>

    <header>
        <h1>Aidan</h1>
        <div class="header-arrow">↓</div>
        <h1>Lewertoff</h1>
    </header>

    <main class="home-container">
        
        <div id="ashtable" class="project-container">
            <div class="project-details">
                <div class="project-row" onclick="toggleProject('ashtable')">
                    <div class="ribbon-home">
                        <img src="projects/ashtable/1.jpg">
                        <img src="projects/ashtable/2.jpg">
                        <img src="projects/ashtable/3.jpg">
                    </div>
                    <div class="project-title">Ashtable</div>
                </div>
                <p class="description">Description du projet Ashtable...</p>
            </div>
        </div>

        <div id="hen-house" class="project-container">
            <div class="project-details">
                <div class="project-row" onclick="toggleProject('hen-house')">
                    <div class="ribbon-home">
                        <img src="projects/hen-house/2.jpg">
                        <img src="projects/hen-house/1.jpg">
                        <img src="projects/hen-house/4.jpg">
                        <img src="projects/hen-house/3.jpg">
                    </div>
                    <div class="project-title">Hen house</div>
                </div>
                <p class="description">Texte du projet HEN HOUSE...</p>
            </div>
        </div>

        <div id="module" class="project-container">
            <div class="project-details">
                <div class="project-row" onclick="toggleProject('module')">
                    <div class="ribbon-home">
                        <img src="projects/module/1.jpg">
                        <img src="projects/module/2.jpg">
                        <img src="projects/module/3.jpg">
                        <img src="projects/module/4.jpg">
                        <img src="projects/module/5.jpg">
                        <img src="projects/module/6.jpg">
                        <img src="projects/module/7.jpg">
                    </div>
                    <div class="project-title">Module</div>
                </div>
                <p class="description">Description du projet Module...</p>
            </div>
        </div>

        <div id="Coffeelet" class="project-container">
            <div class="project-details">
                <div class="project-row" onclick="toggleProject('Coffeelet')">
                    <div class="ribbon-home">
                        <img src="projects/Coffeelet/1.jpg">
                        <img src="projects/Coffeelet/2.jpg">
                        <img src="projects/Coffeelet/3.jpg">
                    </div>
                    <div class="project-title">Coffeelet</div>
                </div>
                <p class="description">Description du projet Coffeelet...</p>
            </div>
        </div>

        <div id="Slab" class="project-container">
            <div class="project-details">
                <div class="project-row" onclick="toggleProject('Slab')">
                    <div class="ribbon-home">
                        <img src="projects/slab/1.jpg">
                        <img src="projects/slab/2.jpg">
                        <img src="projects/slab/3.jpg">
                        <img src="projects/slab/4.jpg">
                    </div>
                    <div class="project-title">slab</div>
                </div>
                <p class="description">Description du projet Slab...</p>
            </div>
        </div>
    
    </main>

    <footer>
        <div><a href="mailto:design@lewertoff.com">design@lewertoff.com</a></div>
        <div><a href="tel:+41797922522">+41 79 792 25 22</a></div>
    </footer>

  <script>
// --- CONFIGURATION ---
document.addEventListener("DOMContentLoaded", () => {
    // Nettoyage au chargement
    document.body.classList.remove('is-project');
    document.querySelectorAll('.project-container').forEach(p => { 
        p.classList.remove('active', 'closing'); 
        p.style = ""; 
    });
    document.querySelectorAll('.project-placeholder').forEach(el => el.remove());
});

// --- VARIABLES ---
let startY = 0;
let isDragging = false;
let activeProjectEl = null;

// --- FONCTION PRINCIPALE ---
function toggleProject(projectId, event) {
    if (event) event.preventDefault();
    
    const body = document.body;
    const isMobile = window.innerWidth <= 900; 
    
    // Identifier le projet cible
    let targetProject;
    if (projectId) {
        targetProject = document.getElementById(projectId);
    } else {
        // Si pas d'ID, on cherche celui qui est actif
        targetProject = document.querySelector('.project-container.active');
    }
    
    if (!targetProject) return;
    
    const ribbon = targetProject.querySelector('.ribbon-home');

    // >>> OUVERTURE <<<
    if (!body.classList.contains('is-project')) {
        
        activeProjectEl = targetProject; // On mémorise quel projet est ouvert

        // Sauvegarde position scroll page principale
        body.dataset.scrollY = window.pageYOffset;
        
        // Calculs positions
        const rect = targetProject.getBoundingClientRect();
        const ribbonRect = ribbon.getBoundingClientRect();
        
        body.dataset.initialTop = rect.top; 
        body.dataset.initialLeft = rect.left; 
        body.dataset.initialWidth = ribbonRect.width;
        body.dataset.initialHeight = ribbonRect.height;

        // Placeholder (Fantôme) pour éviter le saut
        const placeholder = document.createElement('div');
        placeholder.className = 'project-placeholder';
        placeholder.id = 'placeholder-' + targetProject.id;
        placeholder.style.height = rect.height + "px";
        placeholder.style.width = "100%";
        targetProject.parentNode.insertBefore(placeholder, targetProject);

        // Positionnement Fixe immédiat
        targetProject.style.transition = "none";
        targetProject.style.position = "fixed";
        targetProject.style.top = rect.top + "px";
        targetProject.style.left = rect.left + "px";
        targetProject.style.height = ribbonRect.height + "px";
        targetProject.style.zIndex = "2000"; 
        
        targetProject.classList.add('active');
        body.classList.add('is-project');

        // Reset scroll du projet à 0
        targetProject.scrollTop = 0;
        window.scrollTo(0, 0); 

        // Animation d'ouverture
        requestAnimationFrame(() => {
            setTimeout(() => {
                if (!isMobile) {
                    const curve = "all 0.8s cubic-bezier(0.23, 1, 0.32, 1)";
                    targetProject.style.transition = curve;
                    ribbon.style.transition = curve;
                    targetProject.style.top = "10px"; 
                    targetProject.style.left = "0px"; 
                    targetProject.style.height = "100vh"; 
                    ribbon.style.width = "100vw";     
                    ribbon.style.height = "500px";    
                }
                setTimeout(() => { 
                    if(isMobile) targetProject.style.overflowY = "scroll"; 
                    else targetProject.style.overflow = ""; 
                }, 800);
            }, 20);
        });

    } else {
        // >>> FERMETURE <<<

        // Si mobile, on gère l'animation de sortie vers le bas
        if (isMobile) {
            const originalY = parseFloat(body.dataset.scrollY || 0);
            window.scrollTo(0, originalY);

            targetProject.classList.add('closing'); 
            
            // On force une transition fluide pour la fermeture
            targetProject.style.transition = "transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)";
            targetProject.style.transform = "translateY(100%)";

            activeProjectEl = null; // On oublie le projet actif

            setTimeout(() => { cleanUpProject(targetProject, body); }, 400); 
            return; 
        }

        // Version Desktop (inchangée)
        const originalY = parseFloat(body.dataset.scrollY);
        const initialTop = parseFloat(body.dataset.initialTop);
        const initialLeft = parseFloat(body.dataset.initialLeft);
        const initialWidth = parseFloat(body.dataset.initialWidth);
        const initialHeight = parseFloat(body.dataset.initialHeight);
        
        targetProject.style.transition = "none";
        if(ribbon) ribbon.style.transition = "none";
        
        document.querySelectorAll('.project-container:not(.active)').forEach(p => { 
            p.style.opacity = '1'; 
            p.style.pointerEvents = 'none'; 
        });

        window.scrollTo(0, originalY);

        requestAnimationFrame(() => {
            setTimeout(() => {
                const curve = "all 0.8s cubic-bezier(0.23, 1, 0.32, 1)";
                targetProject.style.transition = curve;
                if(ribbon) ribbon.style.transition = curve;
                
                targetProject.style.top = initialTop + "px";
                targetProject.style.left = initialLeft + "px"; 
                targetProject.style.height = initialHeight + "px"; 
                if(ribbon) {
                    ribbon.style.width = initialWidth + "px";
                    ribbon.style.height = initialHeight + "px";
                    ribbon.style.paddingLeft = "0px";
                }
                
                const details = targetProject.querySelector('.project-details');
                if(details) details.style.paddingTop = "0px";
                const row = targetProject.querySelector('.project-row');
                if(row) row.style.marginBottom = "-70px";
                const title = targetProject.querySelector('.project-title');
                if(title) title.style.opacity = '1';
                const desc = targetProject.querySelector('.description');
                if(desc) desc.style.opacity = '0';
            }, 50);
        });

        setTimeout(() => { cleanUpProject(targetProject, body); }, 850);
    }
}

// --- LOGIQUE TACTILE GLOBALE (DOCUMENT) ---
// On écoute sur tout le document pour être sûr de capter le doigt
// même si on touche le Header.

document.addEventListener('touchstart', (e) => {
    // On ne fait rien si aucun projet n'est ouvert ou si on n'est pas sur mobile
    if (!activeProjectEl || window.innerWidth > 900) return;
    
    // On vérifie si on est tout en haut du scroll du projet
    if (activeProjectEl.scrollTop <= 1) {
        startY = e.touches[0].clientY;
        isDragging = true;
    } else {
        isDragging = false;
    }
}, { passive: true });

document.addEventListener('touchmove', (e) => {
    if (!isDragging || !activeProjectEl) return;

    const currentY = e.touches[0].clientY;
    const diff = currentY - startY;

    // Si on tire vers le bas ET qu'on est en haut du projet
    if (diff > 0 && activeProjectEl.scrollTop <= 1) {
        // On empêche le reload natif du navigateur
        if (e.cancelable) e.preventDefault(); 
        
        // On bouge le projet
        activeProjectEl.style.transform = `translateY(${diff * 0.6}px)`; // 0.6 = résistance
    } else {
        // Si on remonte, on arrête le drag pour laisser scroller
        isDragging = false;
        activeProjectEl.style.transform = ""; 
    }
}, { passive: false }); // Important pour que preventDefault fonctionne

document.addEventListener('touchend', (e) => {
    if (!isDragging || !activeProjectEl) return;
    isDragging = false;

    // Calcul de la distance parcourue
    const style = window.getComputedStyle(activeProjectEl);
    const matrix = new WebKitCSSMatrix(style.transform);
    const translateY = matrix.m42;

    // Seuil de fermeture (100px)
    if (translateY > 100) {
        toggleProject(); 
    } else {
        // Rebond (retour à la normale)
        activeProjectEl.style.transition = "transform 0.3s ease-out";
        activeProjectEl.style.transform = "";
        setTimeout(() => {
            if(activeProjectEl) activeProjectEl.style.transition = "";
        }, 300);
    }
});


// --- NETTOYAGE ---
function cleanUpProject(targetProject, body) {
    body.classList.remove('is-project');
    targetProject.classList.remove('active');
    targetProject.classList.remove('closing');
    
    targetProject.removeAttribute('style');
    const ribbon = targetProject.querySelector('.ribbon-home');
    if(ribbon) ribbon.removeAttribute('style');
    
    const details = targetProject.querySelector('.project-details');
    if(details) details.removeAttribute('style');
    const row = targetProject.querySelector('.project-row');
    if(row) row.removeAttribute('style');
    const title = targetProject.querySelector('.project-title');
    if(title) title.removeAttribute('style');
    const desc = targetProject.querySelector('.description');
    if(desc) desc.removeAttribute('style');

    const placeholder = document.getElementById('placeholder-' + targetProject.id);
    if(placeholder) placeholder.remove();

    document.querySelectorAll('.project-container').forEach(p => { 
        p.style = ""; 
        p.style.opacity = "1";
        p.style.pointerEvents = "auto";
    });
    
    activeProjectEl = null;
}

// Scroll Desktop (souris)
window.addEventListener("wheel", (evt) => {
    if (window.innerWidth <= 900) return; 
    if (document.body.classList.contains('is-project')) {
        const activeRibbon = document.querySelector('.project-container.active .ribbon-home');
        if (activeRibbon) {
            evt.preventDefault();
            activeRibbon.scrollLeft += evt.deltaY;
        }
    }
}, { passive: false });
</script>

</body>
</html>